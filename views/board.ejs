<% include partials/head.ejs %>

  <body ng-controller="boardController" ng-init="init('<%= JSON.stringify(user) %>','<%= JSON.stringify(board) %>')" style="background-color: {{board.background}}">
    <navbar user='user'></navbar>

    </div>
    <div>
      <sidebar board='board'></sidebar>

      <div class="board-header">
        <%= board.name %> Prywatna
      </div>
    </div>


    <div id="wrapper">
      <!-- <span> {{results.length}}</span>{{searchCards}} -->
      <!-- <input type="text" ng-model="searchCards.name"> -->
      <!--kc-->
      <ul id="first" dnd-horizontal-list="true" dnd-list="board.lists" dnd-allowed-types="['item']">
        <li ng-repeat="item in board.lists" dnd-draggable="item" dnd-type="'item'" dnd-effect-allowed="move" ng-class="{'selected': board.selected === item}"
          dnd-moved="removeList($index)" dnd-dragstart="logEvent()" dnd-dragend="endEvent()">
          <div>
            <div id="tasks">
              <div class="titleCard">
                {{item.list}}

                <button class="placement" ng-click="activeMenu('Opcje Listy', $event, $index)">
                  <span class="glyphicon">&#xe234;</span>
                </button>
                <div class="menu" ng-click="blockClosingList($event)" ng-class="{active : name === 'Opcje Listy' && toggle === true && indexListMenu === $index }">
                  <span class="menu-heading">Opcje Listy</span>
                  <ul class="options-list">
                    <li class="options-list__item">
                      <a href ng-click="activeMenu('Dodaj kartę', $event, $index)">
                        Dodaj kartę...
                      </a>
                    </li>
                    <li class="options-list__item">
                      <a href ng-click="activeMenu('Kopiuj listę', $event, $index)">
                        Kopiuj listę...
                      </a>
                    </li>
                    <li class="options-list__item">
                      <a href ng-click="activeMenu('Przenieś listę', $event, $index)">
                        Przenieś listę...
                      </a>
                    </li>
                    <li class="options-list__item">
                      <a href ng-click="activeMenu('Zarchiwizuj tę listę', $event, $index)">
                        Zarchiwizuj tę listę...
                      </a>
                    </li>
                  </ul>
                </div>

                <div style="position: relative">
                  <div class="menu" ng-click="blockClosingList($event)" ng-class="{active : name === 'Dodaj kartę' && toggle === true && indexListMenu === $index}">
                    <span class="menu-heading">Dodaj Kartę</span>
                    <form class="copy-list">
                      <div class="form-group">
                        <label>Nazwa</label>
                        <textarea cols="32" rows="3" class="form-control copy-list__textarea"></textarea>
                      </div>
                      <button class="btn btn-success" ng-click="copyList(copyListName, $index)">Utwórz listę</button>
                    </form>
                  </div>
                </div>


                <div style="position: relative">
                  <div class="menu" ng-click="blockClosingList($event)" ng-class="{active : name === 'Kopiuj listę' && toggle === true && indexListMenu === $index}">
                    <span class="menu-heading">Kopiuj Listę</span>
                    <form class="copy-list">
                      <div class="form-group">
                        <label>Nazwa</label>
                        <textarea cols="32" rows="3" class="form-control copy-list__textarea" placeholder="Wprowadź nazwę listy..." ng-model="copyListName"></textarea>
                      </div>
                      <button class="btn btn-success" ng-click="copyList(copyListName, $index)">Utwórz listę</button>
                    </form>
                  </div>
                </div>


                <div style="position: relative">

                  <div class="menu" ng-click="blockClosingList($event)" ng-class="{active : name === 'Przenieś listę' && toggle === true && indexListMenu === $index}">
                    <span class="menu-heading">Przenieś Listę</span>
                    <div class="transfer-wrapper">
                      <form>

                        <div class="transfer-opt">
                          <span>Przenieś do tablicy:</span>
                          <select class="form-control" ng-model="selectedBoard" ng-change="changeBoard(selectedBoard)">
                            <option ng-repeat="item in boards" value="{{item._id}}">{{item.name}}</option>
                          </select>
                        </div>
 
                        <button class="btn btn-success" ng-click="transferList(selectedBoard, $index)">Przenieś</button>

                      </form>
                    </div>
                  </div>

                </div>


                <div style="position: relative">
                  <div class="menu" ng-click="blockClosingList($event)" ng-class="{active : name === 'Zarchiwizuj tę listę' && toggle === true && indexListMenu === $index}">

                  </div>
                </div>

                <!-- end -->
              </div>
              <ol id="second" dnd-list="item.cards" dnd-allowed-types="['card']">
                <li style="margin: 3px 0 3px 0;" ng-repeat="card in item.cards | filter:searchCards as results" dnd-draggable="card" dnd-type="'card'"
                  dnd-effect-allowed="move" dnd-moved="removeItem($parent.$index, $index)" ng-class="{'selected': item.selected === card}">

                  <a style="text-decoration: none; color: black;" data-toggle="modal" ng-click="checkDescStatus($parent.$index, $index, card.description, card.name)"
                    href="#{{card._id}}">
                    <div class="card">
                      <span>{{card.name}}</span>
                    </div>
                  </a>

                </li>
              </ol>
              <div class="addCardForm" ng-click="blockClosingList($event)" ng-class="{active : indexAddCard == $index && toggleAddCard === true}"
                id="id_warstwy2{{$index}}">
                <form>
                  <textarea class="textarea-modif" ng-model="newTask" ng-keypress="($event.keyCode==13) ? addTask(newTask, $index) : return"></textarea>
                  <button class="btn btn-success" ng-click="addTask(newTask, $index)">Dodaj</button>
                  <button class="btn btn-default" ng-click="addCard($index)">Anuluj</button>
                </form>
              </div>
              <a href="#" ng-click="addCard($index);">
                <div ng-class="{deactive : indexAddCard == $index && toggleAddCard === true}" class="addCard" id="id_warstwy{{$index}}">
                  <span>Dodaj kartę...</span>
                </div>
              </a>
            </div>
          </div>
        </li>

        <ul class="third-list" dnd-list="board.lists" dnd-allowed-types="['de']">
          <li ng-class="{deactive : openMenuAddList === true }">
            <div ng-click="addListMenuActiv($event);" class="third-list__btn">
              <span>Dodaj listę...</span>
            </div>
          </li>
          <li>
            <div ng-click="blockClosingList($event)" ng-class="{active : openMenuAddList === true}" class="third-list__input">
              <!--<form ng-submit="addList(newList)">-->
              <form>
                <input type="text" class="form-control" ng-model="newList" placeholder="Dodaj kartę..." />
                <button class="btn btn-success" ng-click="addList(newList)">Dodaj</button>
                <button class="btn btn-default" ng-click="addListMenuActiv($event);">Anuluj</button>
              </form>
            </div>
          </li>
        </ul>
      </ul>
    </div>

    <div ng-repeat="item in board.lists">
      <div ng-repeat="card in item.cards">

        <div id="{{card._id}}" class="modal fade">
          <div class="modal-dialog">
            <div class="modal-content">

              <div class="modal-body">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <!--start-->

                <div class="modal-wrapper">
                  <div class="modal-heading">
                    <div style="position: relative;">
                      <span class="modal-icon glyphicon glyphicon-pushpin"></span>
                      <h4>{{card.name}}</h4>
                    </div>
                    <div>
                      <p class="quiet-heading">
                        W liścię
                        <span class="underline">{{ item.list }}</span>
                      </p>
                    </div>
                  </div>

                  <div class="modal-left-column">
                    <div class="modal-label">
                      <div class="modal-label__items" ng-show="card.labels.length > 0">
                        <p class="quiet-heading">Etykiety</p>
                        <span style="background-color: {{item.colour}}" ng-repeat="item in card.labels">{{item.name}}</span>
                      </div>

                      <div class="modal-deadline" ng-hide="card.deadline === null">
                        <p class="quiet-heading">Termin</p>
                        <span class="modal-deadline__item">{{card.deadline | date:'dd'}} - {{card.deadline | date:'MM'}} o {{card.deadline | date:'HH:mm'}}
                        </span>
                      </div>
                    </div>

                    <description></description>

                    <div class="modal-tasks" ng-repeat="listsTaskItem in card.listsTasks">
                      <list-tasks></list-tasks>
                    </div>
                    <comment></comment>
                  </div>

                  <div class="modal-right-column">

                    <div class="pull-right">
                      <h4 class="loud-header">Dodaj</h4>
                      <div>

                        <div style="position: relative">
                          <a href="#" class="modal-menu__link" ng-click="activeMenu('Członkowie',  $event)">Członkowie</a>
                          <div class="menu" ng-click="blockClosingList($event)" ng-class="{active : name === 'Członkowie' && toggle === true }">
                            <label-panel></label-panel>
                          </div>
                        </div>

                        <div style="position: relative;">
                          <a href="#" class="modal-menu__link" ng-click="activeMenu('addLabel',  $event)">Etykiety</a>
                          <div class="menu" ng-click="blockClosingList($event)" ng-class="{active : name === 'addLabel' && toggle === true }">
                            <span class="menu-heading">Dodaj Etykiete</span>
                            <label-panel></label-panel>
                          </div>
                        </div>
                        <menu-add-list-tasks></menu-add-list-tasks>
                        <menu-deadline></menu-deadline>

                        <div style="position: relative">
                          <a href="#" class="modal-menu__link" ng-click="activeMenu('Załącznik',  $event)">Załącznik</a>

                          <!---->
                          <div class="menu" ng-click="blockClosingList($event)" ng-class="{active : name === 'Załącznik' && toggle === true }">
                            <span class="menu-heading">Dodaj Załącznik</span>

                            <div class="panel-attachment">
                              <form class="panel-attachment__form" enctype="multipart/form-data">
                                <input type="file" fileread="file" />
                                <!-- <button class="btn btn-success panel-attachment__btn pull-right" type="submit" ng-click="uploadAttachment(file)">Wyślij</button>  -->
                              </form>
                            </div>

                          </div>
                        </div>
                      </div>

                      <h4 class="loud-header">Działania</h4>
                      <div>
                        <div style="position: relative">
                          <a href="#" class="modal-menu__link" ng-click="activeMenu('Przenieś',  $event)">Przenieś</a>
                          <menu-transfer-card></menu-transfer-card>
                        </div>

                        <menu-copy-card></menu-copy-card>

                        <a href="#" class="modal-menu__link">Subskrybuj</a>
                        <menu-delete-card></menu-delete-card>
                      </div>
                    </div>
                  </div>

                </div>
                <!--end-->

              </div>
            </div>
            <!-- /.modal-content -->
          </div>
          <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->

      </div>
    </div>






    <script src="/javascripts/angular-timeago.js"></script>
    <script src="/javascripts/board/boardController.js"></script>

    <script src="/navbar/navbar-module.js"></script>
    <script src="/navbar/navbar-component.js"></script>

    <script src="/navbar/profile-menu/profile-menu-component.js"></script>
    <script src="/navbar/notifications/notifications-component.js"></script>
    <script src="/navbar/menu-create/menu-create-component.js"></script>

    <script src="/sidebar/sidebar.js"></script>


    <script src="/directives/label-panel/label-panel-directive.js"></script>
    <script src="/directives/list-tasks/list-tasks-directive.js"></script>
    <script src="/directives/comment/comment-directive.js"></script>
    <script src="/directives/menu-deadline/menu-deadline-directive.js"></script>
    <script src="/directives/menu-copy-card/menu-copy-card-directive.js"></script>
    <script src="/directives/menu-delete-card/menu-delete-card-directive.js"></script>
    <script src="/directives/menu-add-list-tasks/menu-add-list-tasks-directive.js"></script>
    <script src="/directives/description/description-directive.js"></script>
    <script src="/directives/menu-transfer-card/menu-transfer-card-directive.js"></script>


    <script src="/javascripts/angular-datepicker.js"></script>
  </body>

  </html>